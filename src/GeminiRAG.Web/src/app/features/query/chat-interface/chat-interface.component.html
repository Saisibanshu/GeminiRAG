<div class="h-full flex flex-col">
    <mat-card class="flex-1 flex flex-col min-h-0 shadow-sm">
        <mat-card-header class="border-b pb-2 px-4 pt-3 flex-shrink-0">
            <mat-card-title class="text-base m-0">Chat with Your Documents</mat-card-title>
        </mat-card-header>

        <mat-card-content class="flex-1 overflow-auto min-h-0 p-4">
            <div *ngIf="!response && !isLoading && !error"
                class="flex items-center justify-center h-full text-center text-gray-400">
                <div>
                    <mat-icon class="text-6xl mb-3 opacity-40">chat_bubble_outline</mat-icon>
                    <p class="text-base font-medium">Select a document store and ask a question</p>
                    <p class="text-xs mt-1 text-gray-400">Your AI will answer based on your documents</p>
                </div>
            </div>

            <div *ngIf="isLoading" class="flex flex-col items-center justify-center h-full">
                <mat-spinner diameter="40"></mat-spinner>
                <p class="mt-3 text-sm text-gray-500">Searching your documents...</p>
            </div>

            <div *ngIf="error" class="text-red-600 my-4 p-3 bg-red-50 rounded-lg border border-red-200 text-sm">
                <mat-icon class="align-middle mr-1 text-base">error_outline</mat-icon>
                {{ error }}
            </div>

            <div *ngIf="response" class="space-y-3 animate-fade-in">
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-3 rounded-lg border border-blue-100">
                    <div class="flex items-center gap-2 mb-1.5">
                        <mat-icon class="text-blue-600 text-base">help_outline</mat-icon>
                        <h3 class="text-xs font-semibold text-blue-900 uppercase tracking-wide">Your Question</h3>
                    </div>
                    <p class="text-sm text-gray-800 leading-relaxed">{{ question }}</p>
                </div>

                <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-3 rounded-lg border-l-4 border-green-500">
                    <div class="flex items-center gap-2 mb-1.5">
                        <mat-icon class="text-green-600 text-base">smart_toy</mat-icon>
                        <h3 class="text-xs font-semibold text-green-900 uppercase tracking-wide">AI Answer</h3>
                    </div>
                    <div class="text-sm text-gray-800 leading-relaxed whitespace-pre-wrap">{{ response.answer }}</div>
                </div>

                <div *ngIf="response.citations && response.citations.length > 0" class="pt-1">
                    <h4 class="text-xs font-semibold text-gray-500 mb-1.5 uppercase tracking-wide">Sources</h4>
                    <div class="flex flex-wrap gap-1.5">
                        <mat-chip *ngFor="let citation of response.citations" class="text-xs">
                            <mat-icon matChipAvatar class="scale-75">description</mat-icon>
                            {{ citation }}
                        </mat-chip>
                    </div>
                </div>

                <div class="text-xs text-gray-400 text-right">
                    âš¡ {{ response.responseTime }}ms
                </div>
            </div>
        </mat-card-content>

        <mat-card-actions class="p-3 border-t bg-gray-50 flex-shrink-0">
            <div class="w-full flex items-center gap-3">
                <div class="flex-1">
                    <mat-form-field appearance="fill" subscriptSizing="dynamic" class="w-full">
                        <mat-label>Ask a question about your documents</mat-label>
                        <input matInput [(ngModel)]="question" (keyup.enter)="askQuestion()" [disabled]="isLoading"
                            placeholder="Press Enter to send">
                    </mat-form-field>
                </div>

                <button mat-fab color="primary" (click)="askQuestion()" [disabled]="!question || isLoading"
                    matTooltip="Send" class="flex-shrink-0">
                    <mat-icon>send</mat-icon>
                </button>
            </div>
        </mat-card-actions>
    </mat-card>
</div>