<div class="history-container p-6">
    <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold">Query History</h2>
        <div class="flex gap-2">
            <button mat-raised-button color="primary" (click)="exportJson()" [disabled]="history.length === 0">
                <mat-icon>download</mat-icon>
                Export as JSON
            </button>
            <button mat-raised-button (click)="exportMarkdown()" [disabled]="history.length === 0">
                <mat-icon>download</mat-icon>
                Export as Markdown
            </button>
        </div>
    </div>

    <mat-accordion multi>
        <mat-expansion-panel *ngFor="let item of history">
            <mat-expansion-panel-header>
                <mat-panel-title class="font-medium">
                    {{ item.question }}
                </mat-panel-title>
                <mat-panel-description>
                    {{ item.timestamp | date:'short' }}
                </mat-panel-description>
            </mat-expansion-panel-header>

            <div class="py-2">
                <p class="whitespace-pre-wrap text-gray-800">{{ item.answer }}</p>

                <div *ngIf="item.citations?.length" class="mt-2 text-sm text-gray-500">
                    <strong>Sources:</strong> {{ item.citations.join(', ') }}
                </div>
            </div>
        </mat-expansion-panel>
    </mat-accordion>

    <div *ngIf="history.length === 0" class="text-center text-gray-500 py-12">
        <mat-icon class="text-6xl mb-4 text-gray-300">history</mat-icon>
        <p>No history available yet.</p>
        <p class="text-sm mt-2">Your query history will appear here after you ask questions.</p>
    </div>
</div>